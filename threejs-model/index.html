<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Heart model</title>
		<script src="three.js"></script>
		<script src="model.js"></script>
		<script src="catmull-clark.js"></script>
		<script src="TrackballControls.js"></script>
		<script src="dat.gui.js"></script>
		<style>
			body { margin: 0; }
			canvas { width: 80%; height: 100%; }
		</style>
	</head>
	<body>

		<script>
			var scene, camera, renderer;
			var currentModels = [];
			//lv.initialize();
			init();

			function refreshScene() {
				for (var i = 0; i < Models.length; ++i) {
					if (Models[i].visible)
						Models[i].refreshDisplay(scene);
					else
						Models[i].Hide(scene);
				}
			}

			function clearScene() {
				for (var i = 0; i < currentModels.length; ++i) {
					currentModels[i].Hide(scene);
				}
			}

			function init() {

			    scene = new THREE.Scene();

			    camera = new THREE.PerspectiveCamera( 75, (window.innerWidth) / (window.innerHeight), 0.01, 10000 );
			    //camera.position.z = 1000;

				control = new THREE.TrackballControls( camera );

				control.rotateSpeed = 5.0;
				control.zoomSpeed = 1.2;
				control.panSpeed = 0.8;

				control.noZoom = false;
				control.noPan = false;

				control.staticMoving = true;
				control.dynamicDampingFactor = 0.3;

				control.keys = [ 65, 83, 68 ];

				control.addEventListener( 'change', render );

				var spotLight1 = new THREE.SpotLight( 0xffffff );
				spotLight1.position.set( -20, -20, -20 );
				scene.add(spotLight1 );

				var spotLight1 = new THREE.SpotLight( 0xffffff );
				spotLight1.position.set(20, 20, 20 );
				scene.add(spotLight1 );

				var ambientLight = new THREE.AmbientLight(0x404040);
				scene.add(ambientLight);

				//lv.refreshDisplay(scene);
				//lv.updateSubdiv(1);
				//lv.RefreshMesh(scene);

				for (var i = 0; i < Models.length; ++i) {
					Models[i].initialize();
					//currentModels.push(Models[i]);
				}
				//currentModels.push(heart);
				//currentModels.push(lv);

				refreshScene();

			    renderer = new THREE.WebGLRenderer();

				//renderer.setClearColorHex(0xEEEEEE);
				//renderer.se

				camera.position.z = 2;
				camera.position.y = 0.7	;
				//camera.position.x = -0.5	;
				camera.lookAt(scene.position);
				renderer.setSize( window.innerWidth, window.innerHeight);

			    document.body.appendChild( renderer.domElement );


			}

			var controls = new function() {
				this.Control_Mesh = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].returnToControlMesh();
					}
					refreshScene();
				}
				this.Subdivision_1 = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].updateSubdiv(1);
					}
					refreshScene();
				}
				this.Subdivision_2 = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].updateSubdiv(2);
					}
					refreshScene();
				}
				this.Without_Wireframe = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].wireframeMode = 0;
					}
					refreshScene();
				}
				this.With_Wireframe = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].wireframeMode = 1;
					}
					refreshScene();
				}
				this.Only_Wireframe = function () {
					for (var i = 0; i < Models.length; ++i) {
						Models[i].wireframeMode = 2;
					}
					refreshScene();
				}
				this.Heart = function () {
					if (heart.visible)
							heart.visible = false;
					else
							heart.visible = true;
					refreshScene();
				};
				this.Left_Ventricle = function () {
					if (lv.visible)
						lv.visible = false;
					else
						lv.visible = true;
					refreshScene();
				}
				this.Right_Ventricle = function () {
					if (rv.visible)
						rv.visible = false;
					else
						rv.visible = true;
					refreshScene();
				}
				this.Mitral_Valve = function () {
					if (mitral.visible)
						mitral.visible = false;
					else
						mitral.visible = true;
					refreshScene();
				}
				this.Tricuspid_Valve = function () {
					if (tricuspid.visible)
						tricuspid.visible = false;
					else
						tricuspid.visible = true;
					refreshScene();
				}

			};

			var gui = new dat.GUI();
			var f1 = gui.addFolder('Subdivisions');
			f1.add(controls, 'Control_Mesh');
			f1.add(controls, 'Subdivision_1');
			f1.add(controls, 'Subdivision_2');
			
			var f2 = gui.addFolder('Wireframes');
			f2.add(controls, 'Without_Wireframe');
			f2.add(controls, 'With_Wireframe');
			f2.add(controls, 'Only_Wireframe');

			var f3 = gui.addFolder('Models');

			f3.add(controls, 'Heart');
			f3.add(controls, 'Left_Ventricle');
			f3.add(controls, 'Right_Ventricle');
			f3.add(controls, 'Mitral_Valve');
			f3.add(controls, 'Tricuspid_Valve');



			function render() {
				//refreshScene();
				renderer.render(scene, camera);
			}

			function animate() {

			    requestAnimationFrame( animate );
				control.update();
				//mesh.rotation.x += 0.01;
			    //mesh.rotation.y += 0.02;

			    render();

			}

			animate();

		</script>


	</body>
</html>